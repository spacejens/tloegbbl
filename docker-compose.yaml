version: "1"
# TODO Migrate to Docker compose v2, as v1 no longer updates. See https://docs.docker.com/compose/migrate/

services:
  tloegbbl-backend:
    image: tloegbbl-backend
    container_name: tloegbbl-backend
    depends_on:
      - postgres-database
      # TODO Ensure database is ready to accept connections, see https://docs.docker.com/compose/startup-order/
    environment:
      - DATABASE_URL=postgresql://test:test@postgres-database:5432/tloegbbl?schema=tloegbbl
    build:
      dockerfile: Dockerfile
      context: ./backend
      target: deploy
      args:
        PORT: 3000
    restart: on-failure:10
    networks:
      - tloegbbl-network
    ports:
      - 3000:3000
  postgres-database:
    image: postgres
    container_name: tloegbbl-postgres
    environment:
      - POSTGRES_USER=test
      - POSTGRES_PASSWORD=test
      - POSTGRES_DB=tloegbbl
    volumes:
      - tloegbbl-postgres:/var/lib/postgresql/data:rw
    ports:
      - "3001:5432"
    networks:
      - tloegbbl-network

volumes:
  tloegbbl-postgres:
    driver: local

networks:
  tloegbbl-network:
